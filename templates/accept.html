{% extends "base.html" %}
{% block title %}Accept Shift — Peter Pan Coop{% endblock %}

{% block content %}
<h2>Substitution Request</h2>

{# ── Shift details card (always shown) ── #}
<div class="card">
  <div class="detail-row">
    <span class="detail-label">Shift date</span>
    <span>{{ sub.shift_date.strftime("%A, %B %d, %Y") }}</span>
  </div>
  <div class="detail-row">
    <span class="detail-label">Requested by</span>
    <span>{{ sub.requesting_parent_name }}</span>
  </div>
  <div class="detail-row">
    <span class="detail-label">Reason</span>
    <span>{{ sub.reason }}</span>
  </div>
  <div class="detail-row">
    <span class="detail-label">Status</span>
    <span>{% if sub.status == "filled" %}Filled{% else %}Open — needs a volunteer{% endif %}</span>
  </div>
</div>

{# ── Already filled ── #}
{% if already_filled %}
  <div class="alert alert-info">
    This shift has already been filled.
    <strong>{{ sub.accepting_parent_name }}</strong> accepted it on
    {{ sub.accepted_at.strftime("%B %d, %Y at %-I:%M %p") }}.
  </div>

{# ── Just accepted ── #}
{% elif success %}
  <div class="alert alert-success">
    <strong>Thank you, {{ sub.accepting_parent_name }}!</strong>
    You've been recorded as the substitute for
    {{ sub.shift_date.strftime("%A, %B %d, %Y") }}.
    The school will be notified.
  </div>

{# ── Open — show accept form ── #}
{% else %}
  {% if error %}
    <div class="alert alert-error">{{ error }}</div>
  {% endif %}

  <div class="card">
    <p style="margin-bottom:1.2rem; font-size:0.95rem;">
      Can you cover this shift? Select your name below and click <strong>Accept Shift</strong>
      to confirm. First parent to confirm will be the substitute.
    </p>

    <form method="post">
      <label for="accepting_name">Your name</label>
      <select id="accepting_name" name="accepting_name" required>
        <option value="">— select your name —</option>
        {% for parent in parents %}
          <option value="{{ parent }}">{{ parent }}</option>
        {% endfor %}
      </select>

      <button type="submit" class="btn btn-primary">Accept Shift</button>
    </form>
  </div>
{% endif %}
{% endblock %}
